import{e as v,f as x,j as e,s as S,r as a,L as k,A as C,h as I}from"./index-CcnX_Orc.js";import{g as f,S as y}from"./ScrollTrigger-AqcikRin.js";const E="_filterContainer_11rux_1",P="_filterButton_11rux_8",$="_filterButtonSelected_11rux_44",B="_filterGroup_11rux_54",h={filterContainer:E,filterButton:P,filterButtonSelected:$,filterGroup:B},T=({category:t})=>{const s=v(),i=x(j),l=()=>{s(S(t))},d=i===t?`${h.filterButton} ${h.filterButtonSelected}`:h.filterButton;return e.jsx("div",{className:h.filterContainer,children:e.jsx("button",{onClick:l,className:d,type:"button","aria-pressed":i===t,children:t})})},H=()=>{const t=["Все категории","Стеновые и фасадные материалы","Кровля и водосточная система","Цемент и сыпучие материалы","Пиломатериалы и отделка деревом","Электрика","Канализация и водоотведение","Поликарбонат","Краски","Пена монтажная, жидкие гвозди","Сантехника","Кирпич","Погонажные изделия"];return e.jsx("div",{className:h.filterGroup,children:t.map((s,i)=>e.jsx(T,{category:s},i))})},j=t=>t.categoryFilter?.selectedCategory||"Все категории",b="_productCard_1m7et_1",G="_column_1m7et_9",M="_item_1m7et_16",w="_imageContainer_1m7et_32",A="_defaultImage_1m7et_41",U="_itemImage_1m7et_45",z="_cover_1m7et_49",L="_contain_1m7et_52",D="_itemPrice_1m7et_67",R="_itemName_1m7et_75",F="_link_1m7et_86",o={productCard:b,column:G,item:M,imageContainer:w,defaultImage:A,itemImage:U,cover:z,contain:L,itemPrice:D,itemName:R,link:F},O=({product:t})=>{const[s,i]=a.useState(!1),l=t._id||t.id,m=(()=>{if(s)return"/src/shared/assets/shop/default-product.svg";const g=t.imageUrl||t.image;return g?C.getImageUrl(g):"/src/shared/assets/shop/default-product.svg"})(),u=m.includes("default-product"),c=()=>{i(!0)};return e.jsx("div",{className:o.productCard,children:e.jsx(k,{to:`/shop/${l}`,className:o.link,children:e.jsxs("div",{className:`${o.column} ${o.item}`,children:[e.jsx("div",{className:`${o.imageContainer} ${u?o.defaultImage:""}`,children:e.jsx("img",{className:`${o.itemImage} ${u?o.contain:o.cover}`,src:m,alt:t.name||t.title,onError:c,loading:"lazy"})}),e.jsxs("p",{className:o.itemPrice,children:[t.price," руб."]}),e.jsx("span",{className:o.itemName,children:t.name||t.title})]})})})},W="_productsContainer_rkn0h_1",q="_productsGrid_rkn0h_6",J="_loadingContainer_rkn0h_14",K="_loadingSpinner_rkn0h_20",Q="_loadingText_rkn0h_30",V="_errorContainer_rkn0h_36",X="_errorHeading_rkn0h_45",Y="_errorMessage_rkn0h_52",Z="_refreshButton_rkn0h_59",ee="_emptyContainer_rkn0h_77",te="_emptyHeading_rkn0h_83",re="_emptyMessage_rkn0h_90",ne="_animatedElement_rkn0h_118",r={productsContainer:W,productsGrid:q,loadingContainer:J,loadingSpinner:K,loadingText:Q,errorContainer:V,errorHeading:X,errorMessage:Y,refreshButton:Z,emptyContainer:ee,emptyHeading:te,emptyMessage:re,animatedElement:ne};f.registerPlugin(y);const se=()=>{const t=x(j),[s,i]=a.useState([]),[l,d]=a.useState(!0),[m,u]=a.useState(null),c=a.useRef();a.useEffect(()=>{(async()=>{try{d(!0),u(null);const _=await I.get(C.SHOP);i(_.data)}catch(_){u("Не удалось загрузить товары. Проверьте подключение к серверу."),console.error("Error fetching products:",_)}finally{d(!1)}})()},[]),a.useEffect(()=>{const n=c.current;n&&s.length>0&&f.fromTo(n,{y:50,opacity:0},{y:0,opacity:1,duration:.7,scrollTrigger:{trigger:n,start:"top bottom-=70",toggleActions:"play none none reverse"}})},[s]);const g=n=>n?String(n).trim().toLowerCase().replace(/\s+/g," "):"",p=s.filter(n=>{if(t==="Все категории")return!0;if(!n.category)return!1;const _=g(t),N=g(n.category);return _===N});return l?e.jsx("div",{className:r.productsContainer,children:e.jsxs("div",{className:r.loadingContainer,ref:c,children:[e.jsx("div",{className:r.loadingSpinner}),e.jsx("p",{className:r.loadingText,children:"Загрузка товаров..."})]})}):m?e.jsx("div",{className:r.productsContainer,children:e.jsxs("div",{className:r.errorContainer,ref:c,children:[e.jsx("h3",{className:r.errorHeading,children:"Ошибка загрузки"}),e.jsx("p",{className:r.errorMessage,children:m}),e.jsx("button",{onClick:()=>window.location.reload(),className:r.refreshButton,children:"Обновить страницу"})]})}):p.length===0?e.jsx("div",{className:r.productsContainer,children:e.jsxs("div",{className:r.emptyContainer,ref:c,children:[e.jsx("h3",{className:r.emptyHeading,children:"Товары не найдены"}),e.jsx("p",{className:r.emptyMessage,children:t!=="Все категории"?`В категории "${t}" пока нет товаров`:"На данный момент товары отсутствуют"})]})}):e.jsx("div",{className:r.productsContainer,children:e.jsx("div",{className:`${r.productsGrid} ${r.animatedElement}`,ref:c,children:p.map(n=>e.jsx(O,{product:n},n._id||n.id))})})};f.registerPlugin(y);const ie=()=>{const t=a.useRef([]);return t.current=[],a.useEffect(()=>{t.current.forEach(s=>{f.fromTo(s,{y:50,opacity:0},{y:0,opacity:1,duration:.7,scrollTrigger:{trigger:s,start:"top bottom-=70",toggleActions:"play none none reverse"}})})},[]),e.jsx("div",{className:"container-fluid",children:e.jsxs("section",{className:"row",children:[e.jsx("div",{className:"col-12 mb-4",children:e.jsx("div",{className:"card shadow-sm border-0",children:e.jsx(H,{})})}),e.jsx(se,{})]})})};export{ie as default};
